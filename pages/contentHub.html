<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>
        SquadHub
    </title>
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
    <!-- Nucleo Icons -->
     <!--
    <link href="/static/css/nucleo-icons.css" rel="stylesheet" />
    <link href="/static/css/nucleo-svg.css" rel="stylesheet" />
    -->
    <!-- Font Awesome Icons -->
    <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
    <!-- CSS Files -->
    <link id="pagestyle" href="../resources/css/style.css" rel="stylesheet" />
    <script async defer src="https://buttons.github.io/buttons.js"></script>

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <!-- CHART.JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <!--
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.7/css/dataTables.dataTables.css" />
    <script src="https://cdn.datatables.net/2.0.7/js/dataTables.js"></script>
    -->
    <!--
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
     -->
    <!--<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.11/css/jquery.dataTables.min.css">-->

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.11/css/jquery.dataTables.min.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.11/js/jquery.dataTables.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

    <!-- jQuery UI -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="icon" type="image/x-icon" href="../resources/images/squadhublogo.png">

</head>

<style>
    .dateIcon{
        margin-top: 12px;
        margin-left: 1px;
        color: white;
    }


    @media (max-width: 1199px) {

        .menu {
            visibility: visible;
        }

        .navbar-brand{
            visibility: hidden;
        }
    }
</style>

<body class="g-sidenav-show bg-gray-100" id="sidenavMenu">
<div class="min-height-300 bg-primary position-absolute w-100"></div>
<aside
       class="sidenav bg-white navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4 "
       id="sidenav-main">
   <div class="sidenav-header">
    <span class="material-symbols-outlined menu" style="margin-left: 20px; margin-top: 25px; font-size: 40px; color: black;">menu</span>
       <a class="navbar-brand m-0" href="./contentHub.html">
           <img src="../resources/images/squadhublogoblack.png" class="navbar-brand-img h-100" alt="main_logo">
           <span class="ms-1 font-weight-bold">SquadHub</span>
       </a>
       
   </div>
   <hr class="horizontal dark mt-0">
   <div class="collapse navbar-collapse  w-auto " id="sidenav-collapse-main" style="height: 59%;">
       <ul class="navbar-nav userPermissionsActivities">
           <li class="nav-item menuOption" id="0">
               <a class="nav-link nav-link-permissions nav-link-dashboard active">
                   <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                       <span class="material-symbols-outlined">dashboard</span>
                   </div>
                   <span class="nav-link-text ms-1">Dashboard</span>
               </a>
           </li>


       </ul>
   </div>
   <hr class="horizontal dark mt-0">
   <div class="sidenav-footer mx-3 ">
       <div class="card card-plain shadow-none" id="sidenavCard" style="margin-top: 40px">
           <!--<img id="userPhoto" class="mx-auto" src="../resources/images/userDefault.png" alt="sidebar_illustration" style="width: 70px !important; height: 70px;">-->
           <img id="userPhoto" class="mx-auto" src="../resources/images/userDefault.png" alt="sidebar_illustration" style="width: 35% !important; border-radius: 100px;">
           <!--<img class="mx-auto" src="../../../uploads/sobremesas.png" alt="sidebar_illustration" style="width: 35% !important;">-->
           <div class="card-body text-center p-3 w-100 pt-0">
               <div class="user-info">
                   <h6 class="mb-0 userNameDisplay"></h6>
               </div>
           </div>
       </div>

       <a class="btn btn-dark btn-sm w-100" id="perfilBtn" type="button" style="margin-top: 10px;">Perfil</a>
       <a class="btn btn-danger btn-sm w-100 logoutBtn" type="button" style="margin-bottom: 0.6rem !important;">Logout</a>
   </div>
</aside>
<main class="main-content position-relative border-radius-lg ">
   <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl " id="navbarBlur"
         data-scroll="false">
        <div class="container-fluid py-1 px-3">
            <nav aria-label="breadcrumb">
                <span class="material-symbols-outlined menu" style="color: white;">menu</span>
                <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
                    <li class="breadcrumb-item text-sm"><a class="opacity-5 text-white">Pages</a></li>
                    <li class="breadcrumb-item text-sm text-white active changePageName" aria-current="page">Dashboard</li>
                </ol>
                <h6 class="font-weight-bolder text-white mb-0 changePageName">Dashboard</h6>
            </nav>
        </div>
    </nav>
    <!-- End Navbar -->
    <div class="container-fluid py-4">
        <div class="row">

            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4 clubCardDiv">
                <div class="card" style="height: 140px;">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col-8">
                                <div class="numbers">
                                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Clube</p>
                                    <h5 class="font-weight-bolder clubName">

                                    </h5>
                                    <p class="mb-0 clubAbbreviation">
                                    </p>
                                </div>
                            </div>
                            <div class="col-4 text-end-new">
                                <div class="icon icon-shape bg-gradient-success shadow-success text-center rounded-circle">
                                    <span class="material-symbols-outlined dateIcon" aria-hidden="true">stadium</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                <div class="card" style="height: 140px;">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col-8">
                                <div class="numbers">
                                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Data</p>
                                    <h5 class="font-weight-bolder todayDate">
                                    </h5>
                                    <p class="mb-0 weekday">
                                    </p>
                                </div>
                            </div>
                            <div class="col-4 text-end-new">
                                <div class="icon icon-shape bg-gradient-danger shadow-danger text-center rounded-circle">
                                    <span class="material-symbols-outlined dateIcon" aria-hidden="true">calendar_month</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                <div class="card" style="height: 140px;">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col-8">
                                <div class="numbers">
                                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Metereologia</p>
                                    <h5 class="font-weight-bolder meteorologyTemperature">

                                    </h5>
                                    <p class="mb-0 meteorologyCity">
                                    </p>
                                </div>
                            </div>
                            <div class="col-4 text-end-new">
                                <div
                                        class="icon icon-shape bg-gradient-success shadow-success text-center rounded-circle meteorologyIcon">
                                    <!--<i class="meteorologyIcon text-lg opacity-10" aria-hidden="true"></i>-->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="contentHubInjection">
        </div>
    </div>
</main>
</body>

</html>

<script>

    var contentHub = {
        userInfo: null,
        
        getContentHubInitialData: function () {
            
            moment.updateLocale('pt', {
                months: [
                    "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho",
                    "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
                ],
                weekdays: [
                    "Domingo", "Segunda-feira", "Terça-feira", "Quarta-feira", "Quinta-feira",
                    "Sexta-feira", "Sábado"
                ]
            });

                $.ajax({
                    url: "../userInitialData.php",
                    type: "POST",
                    contentType: "application/json",
                    //data: JSON.stringify(obj),
                    data: null,
                    success: function (data) {
                        
                        data = jQuery.parseJSON(data);
                        contentHub.userInfo = data;

                        $(".userNameDisplay").html(contentHub.userInfo.user.username);

                        var htmlToAppend = ''

                        $.each(data.user.permissions, function( key, value ) {
                            if (data.user.idClub == 0){
                                if (value.id == 1 && data.user.role == 1){
                                    htmlToAppend += '<li class="nav-item menuOption" id=' + value.id + '>\n' +
                                        '                <a class="nav-link nav-link-permissions">\n' +
                                        '                    <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">\n' +
                                        '                        <span class="material-symbols-outlined">' + value.icon + '</span>\n' +
                                        '                    </div>\n' +
                                        '                    <span class="nav-link-text ms-1">' + value.name + '</span>\n' +
                                        '                </a>\n' +
                                        '            </li>';
                                }

                                if (value.id == 9){
                                    htmlToAppend += '<li class="nav-item menuOption" id=' + value.id + '>\n' +
                                        '                <a class="nav-link nav-link-permissions">\n' +
                                        '                    <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">\n' +
                                        '                        <span class="material-symbols-outlined">' + value.icon + '</span>\n' +
                                        '                    </div>\n' +
                                        '                    <span class="nav-link-text ms-1">' + value.name + '</span>\n' +
                                        '                </a>\n' +
                                        '            </li>';
                                }
                            }else{
                                if (value.id != 1 && value.isMenu){
                                    htmlToAppend += '<li class="nav-item menuOption" id=' + value.id + '>\n' +
                                        '                <a class="nav-link nav-link-permissions">\n' +
                                        '                    <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">\n' +
                                        '                        <span class="material-symbols-outlined">' + value.icon + '</span>\n' +
                                        '                    </div>\n' +
                                        '                    <span class="nav-link-text ms-1">' + value.name + '</span>\n' +
                                        '                </a>\n' +
                                        '            </li>';
                                }
                            }
                        });

                        $(".userPermissionsActivities").append(htmlToAppend);

                        $(".todayDate").html(moment().locale('pt').format('DD [de] MMMM [de] YYYY'));
                        $(".weekday").html(moment().locale('pt').format('dddd'));

                        if (data.user.clubInfo != null){
                            $(".clubName").html(data.user.clubInfo.name);
                            $(".clubAbbreviation").html(data.user.clubInfo.abbreviation);
                        }else{
                            $(".clubCardDiv").hide()
                        }


                        var apiKey = 'a35bb5ec05b5921304c3baf20ed9cea6'; // chave de API OpenWeatherMap
                        var country = 'Portugal';
                        //var cidade = 'Oliveira de Azeméis';
                        //var cidade = 'Porto';
                        var url = 'https://api.openweathermap.org/data/2.5/weather?q=' + country + '&appid=' + apiKey;

                        $.getJSON(url, function (data) {
                            var temperatura = Math.round(data.main.temp - 273.15); // Conversão de Kelvin para Celsius
                            var icon = 'http://openweathermap.org/img/w/' + data.weather[0].icon + '.png';
                            var city = data.name;

                            $(".meteorologyTemperature").html(temperatura + "°C");
                            $(".meteorologyCity").html(city);
                            $(".meteorologyIcon").html("<img src='" + icon + "'>");
                        });

                        $(".contentHubInjection").load("./dashboard/dashboard.html");

                        if (data.user.photo != null){
                            $("#userPhoto").attr("src", "../../../uploads/" + data.user.photo);
                        }        
                    },
                    error: function () {
                        alert("Problema de autenticação! Efetue a autenticação novamente.");
                        var url = "./login.html";
                        window.location.href = url;
                    }
                });
        }
    };

    $(document).ready(function () {

        contentHub.getContentHubInitialData();
        
        $(".logoutBtn").on("click", function (e) {

            var obj = {
                route: "logout"    
            }

            $.ajax({
                    url: "../route.php",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(obj),
                    success: function (data) {
                        alert(data.message);
                        var url = "./login.html";
                        window.location.href = url;
                    },
                    error: function (data) {
                        var responseText = jQuery.parseJSON(data.responseText);
                        alert(responseText.message);
                    }
                });
        });

        $(document).off('click', '#perfilBtn');
        $(document).on('click', '#perfilBtn', function(e) {
            $(".contentHubInjection").html('');
            $(".contentHubInjection").load("./user/perfil.html");
            $(".changePageName").html("Perfil");
        });

        $(document).on('click', '.menuOption', function(e) {
            var id = e.target.parentElement.id;
            $(".contentHubInjection").html('');
            switch (id){
                case '0':
                    $(".contentHubInjection").load("./dashboard/dashboard.html");
                    $(".changePageName").html("Dashboard");
                    break;
                case '1':
                    $(".contentHubInjection").load("./club/createClub.html");
                    $(".changePageName").html("Create Club");
                    break;
                case '2':
                    $(".contentHubInjection").load("./game/game.html");
                    $(".changePageName").html("Games");
                    break;
                case '6':
                    $(".contentHubInjection").load("./player/player.html");
                    $(".changePageName").html("Players");
                    break;
                case '7':
                    $(".contentHubInjection").load("./coach/coach.html");
                    $(".changePageName").html("Coach");
                    break;
                case '8':
                    $(".contentHubInjection").load("./staff/staff.html");
                    $(".changePageName").html("Staff");
                    break;
                case '9':
                    $(".contentHubInjection").load("./notifications/notifications.html");
                    $(".changePageName").html("Notifications");
                    break;
                case '10':
                    $(".contentHubInjection").load("./training/training.html");
                    $(".changePageName").html("Training Sessions");
                    break;
                case '19':
                    $(".contentHubInjection").load("./injury/injury.html");
                    $(".changePageName").html("Injuries");
                    break;
                case '28':
                    $(".contentHubInjection").load("./performance/performance.html");
                    $(".changePageName").html("Performance");
                    break;
                case '30':
                    $(".contentHubInjection").load("./admin/admin.html");
                    $(".changePageName").html("Admins");
                    break;
            }

        });

        $(document).on('click', '.nav-link-permissions', function(e) {
           $(".nav-link-permissions.active").removeClass("active");
            e.target.className += " active"
        });

        $(document).off('click', '.menu');
        $(document).on('click', '.menu', function(e) {
            
            if($("#sidenavMenu").hasClass("g-sidenav-show")){
                $("#sidenavMenu").removeClass("g-sidenav-show");
            }else{
                $("#sidenavMenu").addClass("g-sidenav-show");
            }
        });

        if ($(window).width() < 1199){
            $(".navbar-brand").remove();
        }else{
            $(".menu").remove();
        }
        
    });

</script>